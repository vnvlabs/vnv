
<div id="main_issue_container">
</div>

<script type="module">

{% include "issues/build.html" %}

const vnv_data =  JSON.parse('{{vnv_data|safe}}')

const mdurl = `https://gitlab.com/api/v4/markdown`

function renderIssueBody(number) {
    var elm =  $('#issue-' + number + '-body')
    if (elm.hasClass('load')){
        elm.removeClass('load');
        $.post(mdurl, {
            text : elm.html()
        }, function (data,status, xhr) {
          elm.html(data.html)
        });
    }
}

function addIssues() {
    let fragment = document.createDocumentFragment();
    vnv_data.forEach(function (issue, index) {

        fragment.appendChild(
              buildIssue({
                        title: issue["title"] || "Issue " + index ,
                        body: issue["description"] || "Default Issue Description",
                        date: issue["date"] || Date.now() ,
                        url : "javascript:void(0);",
                        user: issue["name"] || "Unknown User" ,
                        number: index,
                        user_img: "/static/assets/images/user/AVATARS.png",
                        state : issue["state"] || "open"
                    })
        );

    });
    document.getElementById('main_issue_container').appendChild(fragment) ;
}

$(document).ready(function() {
    addIssues();
});

</script>